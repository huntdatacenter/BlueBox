---
- stat:
    path: "/usr/local/bin/bcftools"
  register: bcftools_installed
- block:
  - set_fact:
      version: "1.10.2"
  - file:
      dest: "/usr/local/src/bcftools"
      state: directory
      mode: '0755'
  - file:
      dest: "/usr/local/lib/bcftools"
      state: directory
      mode: '0755'
  - name: Uncompress bcftools
    unarchive:
      src: "https://github.com/samtools/bcftools/releases/download/{{ version }}/bcftools-{{ version }}.tar.bz2"
      dest: "/usr/local/src"
      remote_src: yes
      creates: "/usr/local/src/bcftools-{{version}}/README"
  - name: Build and Install bcftools
    make:
      chdir: "/usr/local/src/bcftools-{{version}}"
      target: install
      params:
        prefix: "/usr/local/lib/bcftools"
  - file:
      src: "/usr/local/lib/bcftools/bin/bcftools"
      dest: "/usr/local/bin/bcftools"
      state: link
  when: bcftools_installed.stat.exists == false
